/*
 * Copyright 2020 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */ let $488c6ddbf4ef74c2$var$formatterCache = new Map();
let $488c6ddbf4ef74c2$var$supportsSignDisplay = false;
try {
    $488c6ddbf4ef74c2$var$supportsSignDisplay = new Intl.NumberFormat('de-DE', {
        signDisplay: 'exceptZero'
    }).resolvedOptions().signDisplay === 'exceptZero';
// eslint-disable-next-line no-empty
} catch  {}
let $488c6ddbf4ef74c2$var$supportsUnit = false;
try {
    $488c6ddbf4ef74c2$var$supportsUnit = new Intl.NumberFormat('de-DE', {
        style: 'unit',
        unit: 'degree'
    }).resolvedOptions().style === 'unit';
// eslint-disable-next-line no-empty
} catch  {}
// Polyfill for units since Safari doesn't support them yet. See https://bugs.webkit.org/show_bug.cgi?id=215438.
// Currently only polyfilling the unit degree in narrow format for ColorSlider in our supported locales.
// Values were determined by switching to each locale manually in Chrome.
const $488c6ddbf4ef74c2$var$UNITS = {
    degree: {
        narrow: {
            default: "\xb0",
            'ja-JP': " \u5EA6",
            'zh-TW': "\u5EA6",
            'sl-SI': " \xb0"
        }
    }
};
class $488c6ddbf4ef74c2$export$cc77c4ff7e8673c5 {
    /** Formats a number value as a string, according to the locale and options provided to the constructor. */ format(value) {
        let res = '';
        if (!$488c6ddbf4ef74c2$var$supportsSignDisplay && this.options.signDisplay != null) res = $488c6ddbf4ef74c2$export$711b50b3c525e0f2(this.numberFormatter, this.options.signDisplay, value);
        else res = this.numberFormatter.format(value);
        if (this.options.style === 'unit' && !$488c6ddbf4ef74c2$var$supportsUnit) {
            var _UNITS_unit;
            let { unit: unit, unitDisplay: unitDisplay = 'short', locale: locale } = this.resolvedOptions();
            if (!unit) return res;
            let values = (_UNITS_unit = $488c6ddbf4ef74c2$var$UNITS[unit]) === null || _UNITS_unit === void 0 ? void 0 : _UNITS_unit[unitDisplay];
            res += values[locale] || values.default;
        }
        return res;
    }
    /** Formats a number to an array of parts such as separators, digits, punctuation, and more. */ formatToParts(value) {
        // TODO: implement signDisplay for formatToParts
        return this.numberFormatter.formatToParts(value);
    }
    /** Formats a number range as a string. */ formatRange(start, end) {
        if (typeof this.numberFormatter.formatRange === 'function') return this.numberFormatter.formatRange(start, end);
        if (end < start) throw new RangeError('End date must be >= start date');
        // Very basic fallback for old browsers.
        return `${this.format(start)} \u{2013} ${this.format(end)}`;
    }
    /** Formats a number range as an array of parts. */ formatRangeToParts(start, end) {
        if (typeof this.numberFormatter.formatRangeToParts === 'function') return this.numberFormatter.formatRangeToParts(start, end);
        if (end < start) throw new RangeError('End date must be >= start date');
        let startParts = this.numberFormatter.formatToParts(start);
        let endParts = this.numberFormatter.formatToParts(end);
        return [
            ...startParts.map((p)=>({
                    ...p,
                    source: 'startRange'
                })),
            {
                type: 'literal',
                value: " \u2013 ",
                source: 'shared'
            },
            ...endParts.map((p)=>({
                    ...p,
                    source: 'endRange'
                }))
        ];
    }
    /** Returns the resolved formatting options based on the values passed to the constructor. */ resolvedOptions() {
        let options = this.numberFormatter.resolvedOptions();
        if (!$488c6ddbf4ef74c2$var$supportsSignDisplay && this.options.signDisplay != null) options = {
            ...options,
            signDisplay: this.options.signDisplay
        };
        if (!$488c6ddbf4ef74c2$var$supportsUnit && this.options.style === 'unit') options = {
            ...options,
            style: 'unit',
            unit: this.options.unit,
            unitDisplay: this.options.unitDisplay
        };
        return options;
    }
    constructor(locale, options = {}){
        this.numberFormatter = $488c6ddbf4ef74c2$var$getCachedNumberFormatter(locale, options);
        this.options = options;
    }
}
function $488c6ddbf4ef74c2$var$getCachedNumberFormatter(locale, options = {}) {
    let { numberingSystem: numberingSystem } = options;
    if (numberingSystem && locale.includes('-nu-')) {
        if (!locale.includes('-u-')) locale += '-u-';
        locale += `-nu-${numberingSystem}`;
    }
    if (options.style === 'unit' && !$488c6ddbf4ef74c2$var$supportsUnit) {
        var _UNITS_unit;
        let { unit: unit, unitDisplay: unitDisplay = 'short' } = options;
        if (!unit) throw new Error('unit option must be provided with style: "unit"');
        if (!((_UNITS_unit = $488c6ddbf4ef74c2$var$UNITS[unit]) === null || _UNITS_unit === void 0 ? void 0 : _UNITS_unit[unitDisplay])) throw new Error(`Unsupported unit ${unit} with unitDisplay = ${unitDisplay}`);
        options = {
            ...options,
            style: 'decimal'
        };
    }
    let cacheKey = locale + (options ? Object.entries(options).sort((a, b)=>a[0] < b[0] ? -1 : 1).join() : '');
    if ($488c6ddbf4ef74c2$var$formatterCache.has(cacheKey)) return $488c6ddbf4ef74c2$var$formatterCache.get(cacheKey);
    let numberFormatter = new Intl.NumberFormat(locale, options);
    $488c6ddbf4ef74c2$var$formatterCache.set(cacheKey, numberFormatter);
    return numberFormatter;
}
function $488c6ddbf4ef74c2$export$711b50b3c525e0f2(numberFormat, signDisplay, num) {
    if (signDisplay === 'auto') return numberFormat.format(num);
    else if (signDisplay === 'never') return numberFormat.format(Math.abs(num));
    else {
        let needsPositiveSign = false;
        if (signDisplay === 'always') needsPositiveSign = num > 0 || Object.is(num, 0);
        else if (signDisplay === 'exceptZero') {
            if (Object.is(num, -0) || Object.is(num, 0)) num = Math.abs(num);
            else needsPositiveSign = num > 0;
        }
        if (needsPositiveSign) {
            let negative = numberFormat.format(-num);
            let noSign = numberFormat.format(num);
            // ignore RTL/LTR marker character
            let minus = negative.replace(noSign, '').replace(/\u200e|\u061C/, '');
            if ([
                ...minus
            ].length !== 1) console.warn('@react-aria/i18n polyfill for NumberFormat signDisplay: Unsupported case');
            let positive = negative.replace(noSign, '!!!').replace(minus, '+').replace('!!!', noSign);
            return positive;
        } else return numberFormat.format(num);
    }
}


export {$488c6ddbf4ef74c2$export$cc77c4ff7e8673c5 as NumberFormatter, $488c6ddbf4ef74c2$export$711b50b3c525e0f2 as numberFormatSignDisplayPolyfill};
                                                  

//# sourceMappingURL=data:application/json;base64,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LENBQUMsTUFBTSxLQUFLLEdBQ3hCLFFBQVEsSUFBSSxDQUFDO1lBRWYsSUFBSSxXQUFXLFNBQVMsT0FBTyxDQUFDLFFBQVEsT0FBTyxPQUFPLENBQUMsT0FBTyxLQUFLLE9BQU8sQ0FBQyxPQUFPO1lBQ2xGLE9BQU87UUFDVCxPQUNFLE9BQU8sYUFBYSxNQUFNLENBQUM7SUFFL0I7QUFDRiIsInNvdXJjZXMiOlsicGFja2FnZXMvQGludGVybmF0aW9uYWxpemVkL251bWJlci9zcmMvTnVtYmVyRm9ybWF0dGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAyMCBBZG9iZS4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIFRoaXMgZmlsZSBpcyBsaWNlbnNlZCB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5XG4gKiBvZiB0aGUgTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyXG4gKiB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBSRVBSRVNFTlRBVElPTlNcbiAqIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZVxuICogZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5sZXQgZm9ybWF0dGVyQ2FjaGUgPSBuZXcgTWFwPHN0cmluZywgSW50bC5OdW1iZXJGb3JtYXQ+KCk7XG5cbmxldCBzdXBwb3J0c1NpZ25EaXNwbGF5ID0gZmFsc2U7XG50cnkge1xuICBzdXBwb3J0c1NpZ25EaXNwbGF5ID0gKG5ldyBJbnRsLk51bWJlckZvcm1hdCgnZGUtREUnLCB7c2lnbkRpc3BsYXk6ICdleGNlcHRaZXJvJ30pKS5yZXNvbHZlZE9wdGlvbnMoKS5zaWduRGlzcGxheSA9PT0gJ2V4Y2VwdFplcm8nO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHlcbn0gY2F0Y2gge31cblxubGV0IHN1cHBvcnRzVW5pdCA9IGZhbHNlO1xudHJ5IHtcbiAgc3VwcG9ydHNVbml0ID0gKG5ldyBJbnRsLk51bWJlckZvcm1hdCgnZGUtREUnLCB7c3R5bGU6ICd1bml0JywgdW5pdDogJ2RlZ3JlZSd9KSkucmVzb2x2ZWRPcHRpb25zKCkuc3R5bGUgPT09ICd1bml0JztcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5XG59IGNhdGNoIHt9XG5cbi8vIFBvbHlmaWxsIGZvciB1bml0cyBzaW5jZSBTYWZhcmkgZG9lc24ndCBzdXBwb3J0IHRoZW0geWV0LiBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTIxNTQzOC5cbi8vIEN1cnJlbnRseSBvbmx5IHBvbHlmaWxsaW5nIHRoZSB1bml0IGRlZ3JlZSBpbiBuYXJyb3cgZm9ybWF0IGZvciBDb2xvclNsaWRlciBpbiBvdXIgc3VwcG9ydGVkIGxvY2FsZXMuXG4vLyBWYWx1ZXMgd2VyZSBkZXRlcm1pbmVkIGJ5IHN3aXRjaGluZyB0byBlYWNoIGxvY2FsZSBtYW51YWxseSBpbiBDaHJvbWUuXG5jb25zdCBVTklUUyA9IHtcbiAgZGVncmVlOiB7XG4gICAgbmFycm93OiB7XG4gICAgICBkZWZhdWx0OiAnwrAnLFxuICAgICAgJ2phLUpQJzogJyDluqYnLFxuICAgICAgJ3poLVRXJzogJ+W6picsXG4gICAgICAnc2wtU0knOiAnIMKwJ1xuICAgICAgLy8gQXJhYmljPz8gQnV0IFNhZmFyaSBhbHJlYWR5IGRvZXNuJ3QgdXNlIEFyYWJpYyBkaWdpdHMgc28gbWlnaHQgYmUgb2suLi5cbiAgICAgIC8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yMTgxMzlcbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgTnVtYmVyRm9ybWF0T3B0aW9ucyBleHRlbmRzIEludGwuTnVtYmVyRm9ybWF0T3B0aW9ucyB7XG4gIC8qKiBPdmVycmlkZXMgZGVmYXVsdCBudW1iZXJpbmcgc3lzdGVtIGZvciB0aGUgY3VycmVudCBsb2NhbGUuICovXG4gIG51bWJlcmluZ1N5c3RlbT86IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgTnVtYmVyUmFuZ2VGb3JtYXRQYXJ0IGV4dGVuZHMgSW50bC5OdW1iZXJGb3JtYXRQYXJ0IHtcbiAgc291cmNlOiAnc3RhcnRSYW5nZScgfCAnZW5kUmFuZ2UnIHwgJ3NoYXJlZCdcbn1cblxuLyoqXG4gKiBBIHdyYXBwZXIgYXJvdW5kIEludGwuTnVtYmVyRm9ybWF0IHByb3ZpZGluZyBhZGRpdGlvbmFsIG9wdGlvbnMsIHBvbHlmaWxscywgYW5kIGNhY2hpbmcgZm9yIHBlcmZvcm1hbmNlLlxuICovXG5leHBvcnQgY2xhc3MgTnVtYmVyRm9ybWF0dGVyIGltcGxlbWVudHMgSW50bC5OdW1iZXJGb3JtYXQge1xuICBwcml2YXRlIG51bWJlckZvcm1hdHRlcjogSW50bC5OdW1iZXJGb3JtYXQ7XG4gIHByaXZhdGUgb3B0aW9uczogTnVtYmVyRm9ybWF0T3B0aW9ucztcblxuICBjb25zdHJ1Y3Rvcihsb2NhbGU6IHN0cmluZywgb3B0aW9uczogTnVtYmVyRm9ybWF0T3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5udW1iZXJGb3JtYXR0ZXIgPSBnZXRDYWNoZWROdW1iZXJGb3JtYXR0ZXIobG9jYWxlLCBvcHRpb25zKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICB9XG5cbiAgLyoqIEZvcm1hdHMgYSBudW1iZXIgdmFsdWUgYXMgYSBzdHJpbmcsIGFjY29yZGluZyB0byB0aGUgbG9jYWxlIGFuZCBvcHRpb25zIHByb3ZpZGVkIHRvIHRoZSBjb25zdHJ1Y3Rvci4gKi9cbiAgZm9ybWF0KHZhbHVlOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGxldCByZXMgPSAnJztcbiAgICBpZiAoIXN1cHBvcnRzU2lnbkRpc3BsYXkgJiYgdGhpcy5vcHRpb25zLnNpZ25EaXNwbGF5ICE9IG51bGwpIHtcbiAgICAgIHJlcyA9IG51bWJlckZvcm1hdFNpZ25EaXNwbGF5UG9seWZpbGwodGhpcy5udW1iZXJGb3JtYXR0ZXIsIHRoaXMub3B0aW9ucy5zaWduRGlzcGxheSwgdmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMgPSB0aGlzLm51bWJlckZvcm1hdHRlci5mb3JtYXQodmFsdWUpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdGlvbnMuc3R5bGUgPT09ICd1bml0JyAmJiAhc3VwcG9ydHNVbml0KSB7XG4gICAgICBsZXQge3VuaXQsIHVuaXREaXNwbGF5ID0gJ3Nob3J0JywgbG9jYWxlfSA9IHRoaXMucmVzb2x2ZWRPcHRpb25zKCk7XG4gICAgICBpZiAoIXVuaXQpIHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cbiAgICAgIGxldCB2YWx1ZXMgPSBVTklUU1t1bml0XT8uW3VuaXREaXNwbGF5XTtcbiAgICAgIHJlcyArPSB2YWx1ZXNbbG9jYWxlXSB8fCB2YWx1ZXMuZGVmYXVsdDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgLyoqIEZvcm1hdHMgYSBudW1iZXIgdG8gYW4gYXJyYXkgb2YgcGFydHMgc3VjaCBhcyBzZXBhcmF0b3JzLCBkaWdpdHMsIHB1bmN0dWF0aW9uLCBhbmQgbW9yZS4gKi9cbiAgZm9ybWF0VG9QYXJ0cyh2YWx1ZTogbnVtYmVyKTogSW50bC5OdW1iZXJGb3JtYXRQYXJ0W10ge1xuICAgIC8vIFRPRE86IGltcGxlbWVudCBzaWduRGlzcGxheSBmb3IgZm9ybWF0VG9QYXJ0c1xuICAgIHJldHVybiB0aGlzLm51bWJlckZvcm1hdHRlci5mb3JtYXRUb1BhcnRzKHZhbHVlKTtcbiAgfVxuXG4gIC8qKiBGb3JtYXRzIGEgbnVtYmVyIHJhbmdlIGFzIGEgc3RyaW5nLiAqL1xuICBmb3JtYXRSYW5nZShzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLm51bWJlckZvcm1hdHRlci5mb3JtYXRSYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIHRoaXMubnVtYmVyRm9ybWF0dGVyLmZvcm1hdFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIH1cblxuICAgIGlmIChlbmQgPCBzdGFydCkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0VuZCBkYXRlIG11c3QgYmUgPj0gc3RhcnQgZGF0ZScpO1xuICAgIH1cblxuICAgIC8vIFZlcnkgYmFzaWMgZmFsbGJhY2sgZm9yIG9sZCBicm93c2Vycy5cbiAgICByZXR1cm4gYCR7dGhpcy5mb3JtYXQoc3RhcnQpfSDigJMgJHt0aGlzLmZvcm1hdChlbmQpfWA7XG4gIH1cblxuICAvKiogRm9ybWF0cyBhIG51bWJlciByYW5nZSBhcyBhbiBhcnJheSBvZiBwYXJ0cy4gKi9cbiAgZm9ybWF0UmFuZ2VUb1BhcnRzKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKTogTnVtYmVyUmFuZ2VGb3JtYXRQYXJ0W10ge1xuICAgIGlmICh0eXBlb2YgdGhpcy5udW1iZXJGb3JtYXR0ZXIuZm9ybWF0UmFuZ2VUb1BhcnRzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gdGhpcy5udW1iZXJGb3JtYXR0ZXIuZm9ybWF0UmFuZ2VUb1BhcnRzKHN0YXJ0LCBlbmQpO1xuICAgIH1cblxuICAgIGlmIChlbmQgPCBzdGFydCkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0VuZCBkYXRlIG11c3QgYmUgPj0gc3RhcnQgZGF0ZScpO1xuICAgIH1cblxuICAgIGxldCBzdGFydFBhcnRzID0gdGhpcy5udW1iZXJGb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhzdGFydCk7XG4gICAgbGV0IGVuZFBhcnRzID0gdGhpcy5udW1iZXJGb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhlbmQpO1xuICAgIHJldHVybiBbXG4gICAgICAuLi5zdGFydFBhcnRzLm1hcChwID0+ICh7Li4ucCwgc291cmNlOiAnc3RhcnRSYW5nZSd9IGFzIE51bWJlclJhbmdlRm9ybWF0UGFydCkpLFxuICAgICAge3R5cGU6ICdsaXRlcmFsJywgdmFsdWU6ICcg4oCTICcsIHNvdXJjZTogJ3NoYXJlZCd9LFxuICAgICAgLi4uZW5kUGFydHMubWFwKHAgPT4gKHsuLi5wLCBzb3VyY2U6ICdlbmRSYW5nZSd9IGFzIE51bWJlclJhbmdlRm9ybWF0UGFydCkpXG4gICAgXTtcbiAgfVxuXG4gIC8qKiBSZXR1cm5zIHRoZSByZXNvbHZlZCBmb3JtYXR0aW5nIG9wdGlvbnMgYmFzZWQgb24gdGhlIHZhbHVlcyBwYXNzZWQgdG8gdGhlIGNvbnN0cnVjdG9yLiAqL1xuICByZXNvbHZlZE9wdGlvbnMoKTogSW50bC5SZXNvbHZlZE51bWJlckZvcm1hdE9wdGlvbnMge1xuICAgIGxldCBvcHRpb25zID0gdGhpcy5udW1iZXJGb3JtYXR0ZXIucmVzb2x2ZWRPcHRpb25zKCk7XG4gICAgaWYgKCFzdXBwb3J0c1NpZ25EaXNwbGF5ICYmIHRoaXMub3B0aW9ucy5zaWduRGlzcGxheSAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zID0gey4uLm9wdGlvbnMsIHNpZ25EaXNwbGF5OiB0aGlzLm9wdGlvbnMuc2lnbkRpc3BsYXl9O1xuICAgIH1cblxuICAgIGlmICghc3VwcG9ydHNVbml0ICYmIHRoaXMub3B0aW9ucy5zdHlsZSA9PT0gJ3VuaXQnKSB7XG4gICAgICBvcHRpb25zID0gey4uLm9wdGlvbnMsIHN0eWxlOiAndW5pdCcsIHVuaXQ6IHRoaXMub3B0aW9ucy51bml0LCB1bml0RGlzcGxheTogdGhpcy5vcHRpb25zLnVuaXREaXNwbGF5fTtcbiAgICB9XG5cbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRDYWNoZWROdW1iZXJGb3JtYXR0ZXIobG9jYWxlOiBzdHJpbmcsIG9wdGlvbnM6IE51bWJlckZvcm1hdE9wdGlvbnMgPSB7fSk6IEludGwuTnVtYmVyRm9ybWF0IHtcbiAgbGV0IHtudW1iZXJpbmdTeXN0ZW19ID0gb3B0aW9ucztcbiAgaWYgKG51bWJlcmluZ1N5c3RlbSAmJiBsb2NhbGUuaW5jbHVkZXMoJy1udS0nKSkge1xuICAgIGlmICghbG9jYWxlLmluY2x1ZGVzKCctdS0nKSkge1xuICAgICAgbG9jYWxlICs9ICctdS0nO1xuICAgIH1cbiAgICBsb2NhbGUgKz0gYC1udS0ke251bWJlcmluZ1N5c3RlbX1gO1xuICB9XG5cbiAgaWYgKG9wdGlvbnMuc3R5bGUgPT09ICd1bml0JyAmJiAhc3VwcG9ydHNVbml0KSB7XG4gICAgbGV0IHt1bml0LCB1bml0RGlzcGxheSA9ICdzaG9ydCd9ID0gb3B0aW9ucztcbiAgICBpZiAoIXVuaXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndW5pdCBvcHRpb24gbXVzdCBiZSBwcm92aWRlZCB3aXRoIHN0eWxlOiBcInVuaXRcIicpO1xuICAgIH1cbiAgICBpZiAoIVVOSVRTW3VuaXRdPy5bdW5pdERpc3BsYXldKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHVuaXQgJHt1bml0fSB3aXRoIHVuaXREaXNwbGF5ID0gJHt1bml0RGlzcGxheX1gKTtcbiAgICB9XG4gICAgb3B0aW9ucyA9IHsuLi5vcHRpb25zLCBzdHlsZTogJ2RlY2ltYWwnfTtcbiAgfVxuXG4gIGxldCBjYWNoZUtleSA9IGxvY2FsZSArIChvcHRpb25zID8gT2JqZWN0LmVudHJpZXMob3B0aW9ucykuc29ydCgoYSwgYikgPT4gYVswXSA8IGJbMF0gPyAtMSA6IDEpLmpvaW4oKSA6ICcnKTtcbiAgaWYgKGZvcm1hdHRlckNhY2hlLmhhcyhjYWNoZUtleSkpIHtcbiAgICByZXR1cm4gZm9ybWF0dGVyQ2FjaGUuZ2V0KGNhY2hlS2V5KSE7XG4gIH1cblxuICBsZXQgbnVtYmVyRm9ybWF0dGVyID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSwgb3B0aW9ucyk7XG4gIGZvcm1hdHRlckNhY2hlLnNldChjYWNoZUtleSwgbnVtYmVyRm9ybWF0dGVyKTtcbiAgcmV0dXJuIG51bWJlckZvcm1hdHRlcjtcbn1cblxuLyoqIEBwcml2YXRlIC0gZXhwb3J0ZWQgZm9yIHRlc3RzICovXG5leHBvcnQgZnVuY3Rpb24gbnVtYmVyRm9ybWF0U2lnbkRpc3BsYXlQb2x5ZmlsbChudW1iZXJGb3JtYXQ6IEludGwuTnVtYmVyRm9ybWF0LCBzaWduRGlzcGxheTogc3RyaW5nLCBudW06IG51bWJlcik6IHN0cmluZyB7XG4gIGlmIChzaWduRGlzcGxheSA9PT0gJ2F1dG8nKSB7XG4gICAgcmV0dXJuIG51bWJlckZvcm1hdC5mb3JtYXQobnVtKTtcbiAgfSBlbHNlIGlmIChzaWduRGlzcGxheSA9PT0gJ25ldmVyJykge1xuICAgIHJldHVybiBudW1iZXJGb3JtYXQuZm9ybWF0KE1hdGguYWJzKG51bSkpO1xuICB9IGVsc2Uge1xuICAgIGxldCBuZWVkc1Bvc2l0aXZlU2lnbiA9IGZhbHNlO1xuICAgIGlmIChzaWduRGlzcGxheSA9PT0gJ2Fsd2F5cycpIHtcbiAgICAgIG5lZWRzUG9zaXRpdmVTaWduID0gbnVtID4gMCB8fCBPYmplY3QuaXMobnVtLCAwKTtcbiAgICB9IGVsc2UgaWYgKHNpZ25EaXNwbGF5ID09PSAnZXhjZXB0WmVybycpIHtcbiAgICAgIGlmIChPYmplY3QuaXMobnVtLCAtMCkgfHwgT2JqZWN0LmlzKG51bSwgMCkpIHtcbiAgICAgICAgbnVtID0gTWF0aC5hYnMobnVtKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5lZWRzUG9zaXRpdmVTaWduID0gbnVtID4gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobmVlZHNQb3NpdGl2ZVNpZ24pIHtcbiAgICAgIGxldCBuZWdhdGl2ZSA9IG51bWJlckZvcm1hdC5mb3JtYXQoLW51bSk7XG4gICAgICBsZXQgbm9TaWduID0gbnVtYmVyRm9ybWF0LmZvcm1hdChudW0pO1xuICAgICAgLy8gaWdub3JlIFJUTC9MVFIgbWFya2VyIGNoYXJhY3RlclxuICAgICAgbGV0IG1pbnVzID0gbmVnYXRpdmUucmVwbGFjZShub1NpZ24sICcnKS5yZXBsYWNlKC9cXHUyMDBlfFxcdTA2MUMvLCAnJyk7XG4gICAgICBpZiAoWy4uLm1pbnVzXS5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdAcmVhY3QtYXJpYS9pMThuIHBvbHlmaWxsIGZvciBOdW1iZXJGb3JtYXQgc2lnbkRpc3BsYXk6IFVuc3VwcG9ydGVkIGNhc2UnKTtcbiAgICAgIH1cbiAgICAgIGxldCBwb3NpdGl2ZSA9IG5lZ2F0aXZlLnJlcGxhY2Uobm9TaWduLCAnISEhJykucmVwbGFjZShtaW51cywgJysnKS5yZXBsYWNlKCchISEnLCBub1NpZ24pO1xuICAgICAgcmV0dXJuIHBvc2l0aXZlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVtYmVyRm9ybWF0LmZvcm1hdChudW0pO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwidmVyc2lvbiI6MywiZmlsZSI6Ik51bWJlckZvcm1hdHRlci5tb2R1bGUuanMubWFwIiwieF9nb29nbGVfaWdub3JlTGlzdCI6WzBdfQ==